version: '3'

services:

    postgres:
      image: 'postgres:latest'

    redis:
      image: 'redis:latest'

    nginx:
      restart: always
      build: 
        dockerfile: dockerfile.dev
        context: ./nginx
      ports:
        - '3050:80'

    api:
      build:
        dockerfile: dockerfile.dev
        context: './server'
      volumes:
        - /usr/src/app/node_modules
        - ./server:/usr/src/app
      environment:
        - REDIS_HOST=redis
        - REDIS_PORT=6379
        - PGUSER=postgres
        - PGHOST=postgres
        - PGDATABASE=postgres
        - PGPASSWORD=postgres_password
        - PGPORT=5432

    client:
      build:
        dockerfile: dockerfile.dev
        context: ./client
      volumes:
        - /usr/src/app/node_modules
        - ./client:/usr/src/app
    
    worker:
      build:
        dockerfile: dockerfile.dev
        context: ./worker
      volumes:
        - ./usr/src/app/node_modules
        - ./worker:/usr/src/app
      environment:
        - REDIS_HOST=redis
        - REDIS_PORT=6379